<html>
    <!DOCTYPE html>
    <head>
        <meta charset="utf-8">
        <title>My Game</title>
        <style>
            
                #screen {
                    border: 10px solid black;
                    image-rendering: pixelated;
                    image-rendering: crisp-edges;
                    image-rendering: -moz-crisp-edges;
                    width:400px;
                    height:400px;
                }
            
        </style>
    </head>
    <body>
        <p>Test</p>
        <canvas id="screen" width="20" height="20"></canvas>

        <script>
            const screen = document.getElementById('screen');
            const context = screen.getContext('2d');

            
            function createGame(){
                const state = {
                    players:{
                     'player1':{ x:1, y:1},
                     'player2':{ x:17, y:9},
                    },
                    fruits:{
                     'fruit1':{ x:1, y:8},
                     'fruit2':{ x:6, y:9},
                    }
                }
                
                function movePlayer(command){
                    const { playerId, keyPressed } = command;
                    const player = state.players[playerId];

                    const test = {
                        'ArrowUp':()=> player.y>0 ? player.y-=1:false,
                        'ArrowDown':()=> player.y<screen.height-1 ? player.y+=1 :false,
                        'ArrowLeft':()=> player.x>0 ? player.x-=1:false,
                        'ArrowRight':()=> player.x<screen.width-1? player.x+=1 :false,
                    }

                    test[keyPressed]();

                }

                return {
                    movePlayer,
                    state
                }
            }

            const game = createGame();
            const keyboardListener = createKeyboardListener();
            keyboardListener.subscribe(game.movePlayer);
            
            function createKeyboardListener(){
                const state = {
                    observers:[]
                }
                function subscribe(observerFunction){
                    state.observers.push(observerFunction);
                }

                function notifyAll(command){
                    state.observers.map( observerFunction => observerFunction(command) );
                }

                document.addEventListener('keydown', handleKeyDown);
    
                function handleKeyDown(event){
                    const command = {
                        playerId:'player1',
                        keyPressed:event.key
                    }
                  
                    notifyAll(command);
                }

                return {
                    subscribe
                }
            }


            renderScreen();

            function renderScreen(){
                context.clearRect(0,0, screen.width, screen.height);
                const { state } = game;

                for(const playerId in state.players){
                    const player = state.players[playerId];

                    context.fillStyle='black';
                    context.fillRect(player.x,player.y,1,1);
                }

                for(const fruitId in state.fruits){
                    const fruit = state.fruits[fruitId];

                    context.fillStyle='green';
                    context.fillRect(fruit.x,fruit.y,1,1);
                }

                requestAnimationFrame(renderScreen);
            }


        </script>
    </body>
</html>
